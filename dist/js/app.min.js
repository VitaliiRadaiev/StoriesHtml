class ImageStory{constructor({htmlContainer:t,url:e,duration:s}){this.htmlContainer=t,this.url=e,this.progressFns=[],this.endsFns=[],this.readyFns=[],this.canPlay=!1,this.isInit=!1,this.duration=s}init(){this.htmlContainer.style.setProperty("background-image",`url(${this.url})`),this.animation=this._createAnimator({duration:1e3*this.duration,timing:t=>t,draw:t=>{this.progressFns.forEach((e=>e(t)))},onEnd:()=>{this.endsFns.forEach((t=>t()))}}),this.canPlay=!0,this.isInit=!0,this.readyFns.forEach((t=>t()))}play(){this.animation.start()}pause(){this.animation.pause()}stop(){this.animation?.reset()}onProgress(t){this.progressFns.push(t)}onEnd(t){this.endsFns.push(t)}onReady(t){this.readyFns.push(t)}_createAnimator=({timing:t,draw:e,duration:s,onEnd:i})=>{let r=null,n=null,o=null;const a=d=>{r||(r=d),n&&(r+=d-n,n=null);let h=(d-r)/s;h>1&&(h=1);let l=t(h);e(l),h<1?o=requestAnimationFrame(a):(i(),r=null)};return{start:()=>{o||(o=requestAnimationFrame(a))},pause:()=>{o&&(n=performance.now(),cancelAnimationFrame(o),o=null)},reset:()=>{o&&(cancelAnimationFrame(o),o=null),r=null,n=null}}}}class VideoStory{constructor({htmlContainer:t,url:e,videoType:s,duration:i}){this.htmlContainer=t,this.url=e,this.progressFns=[],this.endsFns=[],this.readyFns=[],this.canPlay=!1,this.isInit=!1,this.duration=i,this.videoType=s}init(){const t=this.videoType,e=document.createElement("video");e.setAttribute("muted","muted"),e.setAttribute("playsinline","playsinline"),e.setAttribute("disablepictureinpicture",""),e.setAttribute("controlslist","nodownload noplaybackrate"),e.setAttribute("type",t),this.htmlContainer.append(e),this.player=videojs(e),this.player.src({type:t,src:this.url}),this.player.ready((()=>{this.canPlay=!0,this.readyFns.forEach((t=>t()))})),this.player.on("timeupdate",((t,e)=>{const s=this.duration<=this.player.duration()?this.duration:this.player.duration(),i=this.player.currentTime(),r=i/s;this.progressFns.forEach((t=>t(Math.min(r,1)))),i>=s&&(this.player.pause(),this.endsFns.forEach((t=>t())))})),this.player.on("ended",(()=>{this.endsFns.forEach((t=>t()))})),this.isInit=!0}play(){this.player.play()}pause(){this.player.pause()}stop(){this.player.currentTime(0),this.player.pause()}onProgress(t){this.progressFns.push(t)}onEnd(t){this.endsFns.push(t)}onReady(t){this.readyFns.push(t)}}class Stories{constructor({storiesContainer:t,progressLineContainer:e,btnPlayPause:s}){this.storiesContainer=t,this.progressLineContainer=e,this.btnPlayPause=s,this.stories=this._initStories(),this._isEnd=!1,this._isStart=!0,this.readyFns=[],this.endFns=[],this.changeFns=[],this.activeStoryIndex=0,this.prevActiveStoryIndex=0,this.prevItems=[],this.progressAnimation=!0}init(){this._createProgressLines(),this._setEvents();this.stories[0].onReady((()=>{this.readyFns.forEach((t=>t()))})),this._render()}play(){const t=this.stories[this.activeStoryIndex];this.prevItems.forEach(((e,s)=>{e&&e!==t&&e.stop()}));const e=()=>{t.canPlay?(t.play(),this.btnPlayPause&&this.btnPlayPause.classList.add("pause")):setTimeout((()=>{e()}),200)};e()}pause(){this.stories[this.activeStoryIndex].pause(),this.btnPlayPause&&this.btnPlayPause.classList.remove("pause")}next(){this.activeStoryIndex!==this.stories.length-1&&(this.activeStoryIndex++,this._updateProgressLines(),this._render(),this.play(),this.changeFns.forEach((t=>t())))}prev(){0!==this.activeStoryIndex&&(this.activeStoryIndex--,this._updateProgressLines(),this._render(),this.play(),this.changeFns.forEach((t=>t())))}stop(){this.stories[this.activeStoryIndex].stop()}get isEnd(){return this._isEnd}get isStart(){return this._isStart}onReady(t){this.readyFns.push(t)}onEnd(t){this.endFns.push(t)}onStoryChange(t){this.changeFns.push(t)}_createProgressLines(){const t=this.stories.map((t=>{const e=document.createElement("div");return e.className="progress-line",e.style.setProperty("--value","0%"),e}));this.progressLineContainer.append(...t)}_updateProgressLines(){Array.from(this.progressLineContainer.children).forEach(((t,e)=>{const s=this.activeStoryIndex;e<s?(t.classList.add("viewed"),t.classList.remove("active"),this._setProgress(t,0)):e===s?(t.classList.remove("viewed"),t.classList.add("active"),this._setProgress(t,0)):e>s&&(t.classList.remove("viewed"),t.classList.remove("active"),this._setProgress(t,0))}))}_initStories(){return Array.from(this.storiesContainer.children).map((t=>{const e=t.getAttribute("data-story-type");let s;return"image"===e&&(s=new ImageStory({htmlContainer:t,url:t.getAttribute("data-url"),duration:t.getAttribute("data-story-duration")||6})),"video"===e&&(s=new VideoStory({htmlContainer:t,url:t.getAttribute("data-url"),videoType:t.getAttribute("data-video-type"),duration:t.getAttribute("data-story-duration")||6})),t.remove(),s}))}_render(){const t=this.activeStoryIndex,e=this.prevActiveStoryIndex,s=this.stories,i=this.prevItems,r=[s[t-1],s[t],s[t+1]];r.forEach(((s,r)=>{s&&(1===r?s.htmlContainer.classList.add("active"):s.htmlContainer.classList.remove("active"),i.includes(s)||(s.isInit||s.init(),e<t?this.storiesContainer.append(s.htmlContainer):this.storiesContainer.prepend(s.htmlContainer)))})),i.forEach((t=>{t&&(r.includes(t)||t.htmlContainer.remove())})),this.prevItems=r,this.prevActiveStoryIndex=t,this._checkIndexPosition()}_checkIndexPosition(){this.activeStoryIndex===this.stories.length-1?this._isEnd=!0:this._isEnd=!1,0===this.activeStoryIndex?this._isStart=!0:this._isStart=!1}_setEvents(){this.stories.forEach(((t,e)=>{const s=this.progressLineContainer.children[e];t.onProgress((t=>{this.activeStoryIndex===e&&this._setProgress(s,t)})),t.onEnd((()=>{this.isEnd?this.endFns.forEach((t=>t())):this.next()})),t.onReady((()=>{}))}))}_setProgress(t,e){this.progressAnimation?t.style.removeProperty("transition"):t.style.setProperty("transition","all 0s linear"),t.style.setProperty("--value",100*e+"%")}_removeProgressAnimation(){this.progressAnimation=!1,setTimeout((()=>{this.progressAnimation=!0}),300)}}class StoryCard{constructor(t){this.htmlContainer=t,this.previewHtmlContainer=t.querySelector(".stories-card__preview"),this.stories=null,this.canPlayFns=[],this.onEndFns=[],this.changeFns=[],this.onBeforeStartFns=[],this.isCanPlay=!1}init(){this._initStories(),this._initEvents(),this.htmlContainer.classList.add("stories-card-initialized")}onCanPlay(t){this.canPlayFns.push(t)}onEnd(t){this.onEndFns.push(t)}onBeforeStart(t){this.onBeforeStartFns.push(t)}onStoryChange(t){this.changeFns.push(t)}play(){this.stories&&this.stories.play()}pause(){this.stories&&this.stories.pause()}next(){this.stories&&this.stories.next()}prev(){this.stories&&this.stories.prev()}hidePreview(){this.previewHtmlContainer.classList.add("hide")}showPreview(){this.previewHtmlContainer.classList.remove("hide")}_initStories(){this.stories=new Stories({storiesContainer:this.htmlContainer.querySelector(".stories-card__stories"),progressLineContainer:this.htmlContainer.querySelector(".stories-card__progress-lines"),btnPlayPause:this.htmlContainer.querySelector(".stories-card__play-pause-btn")}),this.stories.onReady((()=>{this.isCanPlay=!0,this.canPlayFns.forEach((t=>t()))})),this.stories.onEnd((()=>{this.onEndFns.forEach((t=>t()))})),this.stories.onStoryChange((()=>{this.changeFns.forEach((t=>t()))})),this.stories.init()}_initEvents(){if(!this.stories)return;if(!this.htmlContainer)return;const t=this.htmlContainer.querySelector(".stories-card__play-pause-btn"),e=this.htmlContainer.querySelector(".stories-card__stories");t.addEventListener("click",(()=>{t.classList.contains("pause")?this.stories.pause():this.stories.play()}));const s=e;let i,r=0,n=0,o=0,a=0,d=0;s.addEventListener("pointerdown",(t=>{r=t.clientX,n=t.clientY,d=performance.now(),this.stories.pause(),i=setTimeout((()=>{}),150),this.stories.pause()})),s.addEventListener("pointerup",(t=>{clearTimeout(i),o=t.clientX,a=t.clientY;const s=performance.now()-d;if(this.stories.play(),s<150&&Math.abs(o-r)<5&&Math.abs(a-n)<5&&isMobile()&&document.documentElement.clientWidth<920){const s=.75*e.clientWidth;if(t.clientX>s){if(this.stories.isStart)return void this.onBeforeStartFns.forEach((t=>t()));this.stories.prev()}else{if(this.stories.isEnd)return void this.onEndFns.forEach((t=>t()));this.stories.next()}}})),s.addEventListener("pointermove",(t=>{performance.now()-d<150&&(o=t.clientX,a=t.clientY,(Math.abs(o-r)>10||Math.abs(a-n)>10)&&clearTimeout(i))})),s.addEventListener("pointercancel",(()=>{clearTimeout(i)})),s.addEventListener("pointerleave",(()=>{clearTimeout(i)}))}}class StoriesCarousel{constructor(t){this.htmlContainer=t,this.carousel=this.htmlContainer.querySelector('[data-slider="stories-carousel"]'),this.btnLeft=this.htmlContainer.querySelector(".btn-left"),this.btnRight=this.htmlContainer.querySelector(".btn-right"),this.swiper=null,this.isMobile=document.documentElement.clientWidth<920,this.prevStoryCard=null,this._init()}_init(){this._initSlider(),this._initStoriesCards(),this._addEvents()}_initSlider(){const t=this.carousel.querySelector(".swiper");let e=document.documentElement.clientWidth<920;const s=()=>{document.documentElement.clientWidth>=920&&!e&&(t.classList.contains("swiper-initialized")&&this.swiper.destroy(),this.swiper=new Swiper(t,{grabCursor:!0,centeredSlides:!0,slidesPerView:1,touchRatio:0,grabCursor:!1,speed:400,on:{init:t=>{this._checkButtonsVisibility(t)},slideChangeTransitionStart:async t=>{await this._startActiveCard(),this._checkButtonsVisibility(t)}}}),e=!0),document.documentElement.clientWidth<920&&e&&(t.classList.contains("swiper-initialized")&&this.swiper.destroy(),this.swiper=new Swiper(t,{effect:"cube",grabCursor:!0,speed:400,threshold:10,cubeEffect:{shadow:!0,slideShadows:!0,shadowOffset:20,shadowScale:.94},on:{slideChangeTransitionStart:async()=>{await this._startActiveCard()}}}),e=!1)};s(),window.addEventListener("resize",(()=>{s()}))}_initStoriesCards(){this.swiper.slides.forEach((t=>{const e=t.querySelector(".stories-card");e.classList.contains("stories-card-initialized")||(t.storyCard=new StoryCard(e),t.storyCard.onEnd((()=>{this.swiper.slideNext()})),t.storyCard.onBeforeStart((()=>{this.swiper.slidePrev()})),t.storyCard.onStoryChange((()=>{this._checkButtonsVisibility(this.swiper)})),t.storyCard.init())}))}_addEvents(){this.carousel.addEventListener("click",(t=>{if(!this.isMobile&&t.target.closest(".stories-card")){const e=t.target.closest(".swiper-slide");if(!e.classList.contains("swiper-slide-active")){const t=this.swiper.slides.indexOf(e);this.swiper.slideTo(t)}}})),this.btnLeft.addEventListener("click",(()=>{this.isMobile||this.next()})),this.btnRight.addEventListener("click",(()=>{this.isMobile||this.prev()})),document.addEventListener("click",(t=>{if(t.target.closest('[data-action="open-stories"]')){t.preventDefault();const e=t.target.closest('[data-action="open-stories"]').getAttribute("data-id");if(!e)return;this.show(e)}t.target.closest('[data-action="close-stories"]')&&(t.preventDefault(),this.hide())}));const t=this.htmlContainer.querySelector(".swiper-wrapper");new MutationObserver((t=>{this._initStoriesCards()})).observe(t,{childList:!0}),document.addEventListener("contextmenu",(function(t){"IMG"===t.target.tagName&&t.preventDefault(),"VIDEO"===t.target.tagName&&t.preventDefault()}))}_checkButtonsVisibility(t){t.isBeginning?this.btnRight.classList.add("hidden"):this.btnRight.classList.remove("hidden"),t.isEnd?this.btnLeft.classList.add("hidden"):this.btnLeft.classList.remove("hidden");const e=t.slides[t.realIndex]?.storyCard;e&&e.stories&&(e.stories.isStart?this.btnRight.classList.add("stories-start"):this.btnRight.classList.remove("stories-start"),e.stories.isEnd?this.btnLeft.classList.add("stories-end"):this.btnLeft.classList.remove("stories-end"))}_getScrollbarWidth(){return window.innerWidth-document.querySelector("body").offsetWidth}_toggleDisablePageScroll(t){if(t){const t=this._getScrollbarWidth();document.documentElement?.classList.add("overflow-hidden"),document.body?.classList.add("overflow-hidden"),document.documentElement.style.paddingRight=t+"px"}else document.documentElement?.classList.remove("overflow-hidden"),document.body?.classList.remove("overflow-hidden"),document.documentElement.style.removeProperty("padding-right")}_compensateWidthOfScrollbar(t){if(t){const t=this._getScrollbarWidth();document.documentElement.style.paddingRight=t+"px"}else document.documentElement.style.paddingRight="0px"}async _startActiveCard(){const t=this.swiper.slides[this.swiper.realIndex]?.storyCard;t&&(t.isCanPlay||await new Promise((e=>{t.onCanPlay((()=>{e()}))})),t.stories&&(t.hidePreview(),t.play(),t!==this.prevStoryCard&&(this.prevStoryCard?.showPreview(),this.prevStoryCard?.stories?.stop(),this.prevStoryCard=t)))}pause(){const t=this.swiper.slides[this.swiper.realIndex]?.storyCard;t&&t.pause()}play(){const t=this.swiper.slides[this.swiper.realIndex]?.storyCard;t&&t.play()}show(t){if(this.swiper.slides.find((t=>t.classList.contains("swiper-slide-active"))).querySelector(".stories-card").getAttribute("data-id")===t)this._startActiveCard();else{const e=t?this.swiper.slides.findIndex((e=>e.querySelector(".stories-card").getAttribute("data-id")===t)):0;this.swiper.slideTo(e,0)}this._toggleDisablePageScroll(!0),this._compensateWidthOfScrollbar(!0),this.htmlContainer.classList.add("stories-popup--open")}hide(){this._toggleDisablePageScroll(!1),this._compensateWidthOfScrollbar(!1),this.htmlContainer.classList.remove("stories-popup--open");const t=this.swiper.slides[this.swiper.realIndex]?.storyCard;t&&(t.pause(),t.stories.stop())}next(){const t=this.swiper.slides[this.swiper.realIndex]?.storyCard;t&&t.stories&&(t.stories.isEnd?this.swiper.slideNext():t.stories.next())}prev(){const t=this.swiper.slides[this.swiper.realIndex]?.storyCard;t&&t.stories&&(t.stories.isStart?this.swiper.slidePrev():t.stories.prev())}}function isSafari(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function Android(){return navigator.userAgent.match(/Android/i)}function BlackBerry(){return navigator.userAgent.match(/BlackBerry/i)}function iOS(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)}function Opera(){return navigator.userAgent.match(/Opera Mini/i)}function Windows(){return navigator.userAgent.match(/IEMobile/i)}function isMobile(){return Android()||BlackBerry()||iOS()||Opera()||Windows()}function slideUp(t,e=500){t.style.transitionProperty="height, margin, padding",t.style.transitionDuration=e+"ms",t.style.height=t.offsetHeight+"px",t.offsetHeight,t.style.overflow="hidden",t.style.height=0,t.style.paddingTop=0,t.style.paddingBottom=0,t.style.marginTop=0,t.style.marginBottom=0,window.setTimeout((()=>{t.style.display="none",t.style.removeProperty("height"),t.style.removeProperty("padding-top"),t.style.removeProperty("padding-bottom"),t.style.removeProperty("margin-top"),t.style.removeProperty("margin-bottom"),t.style.removeProperty("overflow"),t.style.removeProperty("transition-duration"),t.style.removeProperty("transition-property"),t?.classList.remove("_slide")}),e)}function slideDown(t,e=500){t.style.removeProperty("display");let s=window.getComputedStyle(t).display;"none"===s&&(s="block"),t.style.display=s;let i=t.offsetHeight;t.style.overflow="hidden",t.style.height=0,t.style.paddingTop=0,t.style.paddingBottom=0,t.style.marginTop=0,t.style.marginBottom=0,t.offsetHeight,t.style.transitionProperty="height, margin, padding",t.style.transitionDuration=e+"ms",t.style.height=i+"px",t.style.removeProperty("padding-top"),t.style.removeProperty("padding-bottom"),t.style.removeProperty("margin-top"),t.style.removeProperty("margin-bottom"),window.setTimeout((()=>{t.style.removeProperty("height"),t.style.removeProperty("overflow"),t.style.removeProperty("transition-duration"),t.style.removeProperty("transition-property"),t?.classList.remove("_slide")}),e)}function slideToggle(t,e=500){if(!t?.classList.contains("_slide"))return t?.classList.add("_slide"),"none"===window.getComputedStyle(t).display?this.slideDown(t,e):this.slideUp(t,e)}window.addEventListener("DOMContentLoaded",(()=>{isMobile()&&document.body.classList.add("mobile-device");{const e=document.querySelector('[data-slider="stories-nav"]');if(e){const s=e.querySelector(".swiper");let i;function t(){document.documentElement.clientWidth>=920&&"false"==e.dataset.mobile&&(i=new Swiper(e.querySelector(".swiper"),{speed:500,watchSlidesProgress:!0,watchSlidesVisibility:!0,slidesPerView:10,spaceBetween:20,slidesPerGroup:5,touchRatio:0,navigation:{nextEl:e.querySelector(".btn-left"),prevEl:e.querySelector(".btn-right")}}),e.dataset.mobile="true"),document.documentElement.clientWidth<920&&(e.dataset.mobile="false",s.classList.contains("swiper-initialized")&&i.destroy())}t(),window.addEventListener("resize",(()=>{t()}))}}}));